<!DOCTYPE HTML>
<html xmlns:wb="http://open.weibo.com/wb"
      xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>无限创想人才招聘平台</title>

    <link rel="shortcut icon" th:href="@{static/img/html.ico}" type="image/x-icon"/>

    <link rel="stylesheet" type="text/css" th:href="@{static/css/style.css}"/>
    <link rel="stylesheet" th:href="@{static/css/amazeui.css}"/>
    <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" th:href="@{static/css/core.css}"/>
    <link rel="stylesheet" th:href="@{static/css/menu.css}"/>
    <link rel="stylesheet" th:href="@{static/css/admin.css}"/>
    <link rel="stylesheet" th:href="@{static/css/page/typography.css}"/>
    <link rel="stylesheet" th:href="@{static/css/page/form.css}"/>
</head>
<body style="background-color:#F0F0F0;" onkeydown="keyLogin()">
<div id="header">
    <div class="wrapper">
        <a th:href="@{'/home'}" class="logo">
            <img th:src="@{static/img/logo_home.png}" width="229" height="43"/>
        </a>
        <ul class="reset" id="navheader">
            <li><a th:href="@{'/home'}">首&nbsp;&nbsp;&nbsp;&nbsp;页</a></li>
            <li><a th:href="@{'/jobSearch'}">职位搜索</a></li>
            <li><a th:href="@{'/redirNews'}">职业资讯</a></li>
            <li><a th:href="@{'/forum'}" rel="nofollow">交流论坛</a></li>
            <li class="current"><a th:href="@{'/userInfoPage'}" rel="nofollow">我的信息</a></li>
        </ul>
    </div>
</div><!-- end #header -->
<div class="admin">
    <!--<div class="am-g">-->
    <!-- ========== Left Sidebar Start ========== -->
    <!--<div class="left side-menu am-hide-sm-only am-u-md-1 am-padding-0">
        <div class="slimScrollDiv" style="position: relative; overflow: hidden; width: auto; height: 548px;">
            <div class="sidebar-inner slimscrollleft" style="overflow: hidden; width: auto; height: 548px;">-->
    <!-- sidebar start -->
    <div class="admin-sidebar am-offcanvas am-padding-0" id="admin-offcanvas" style="margin-top: 0;overflow-y: hidden;">
        <div class="am-offcanvas-bar admin-offcanvas-bar">
            <!-- User -->
            <div class="user-box am-hide-sm-only" style="margin-top: 25px;">
                <div class="user-img">
                    <img th:src="@{'static/img/userImg/' + ${session.user.getUserID()} + '.jpg'}" alt="user-img" title="Mat Helme"
                         class="img-circle img-thumbnail img-responsive" onerror="this.src='static/img/userImg/default.jpg'">
                    <div class="user-status offline"><i class="am-icon-dot-circle-o" aria-hidden="true"></i></div>
                </div>
                <br/>
                <span style="font-weight:bold; color:#89b0de" th:text="${session.user.getNickName()}"></span>，欢迎你！
            </div>
            <!-- End User -->

            <ul class="am-list admin-sidebar-list">
                <li><a th:href="@{'/userInfoPage'}"><span class="am-icon-home"></span>&nbsp;&nbsp;个人主页</a></li>
                <li class="admin-parent" style="font-size: 20px;font-weight: bold;">
                    <a th:href="@{'/myInfo'}" class="am-cf" data-am-collapse="{target: '#collapse-nav1'}">
                        <span class="am-icon-file"></span>&nbsp;&nbsp;我的信息</a>
                </li>
                <li class="admin-parent">
                    <a th:href="@{'/myPost'}" class="am-cf" data-am-collapse="{target: '#collapse-nav2'}">
                        <span class="am-icon-table"></span>&nbsp;&nbsp;我的发帖</a>
                </li>
                <li class="admin-parent">
                    <a th:href="@{'/myJobApply'}" class="am-cf" data-am-collapse="{target: '#collapse-nav2'}">
                        <span class="am-icon-envelope"></span>&nbsp;&nbsp;我的投递</a>
                </li>
                <li class="admin-parent">
                    <a th:href="@{'/myCV'}" class="am-cf" data-am-collapse="{target: '#collapse-nav2'}">
                        <span class="am-icon-archive"></span>&nbsp;&nbsp;我的简历</a>
                </li>
                <li class="admin-parent">
                    <a class="am-cf" data-am-collapse="{target: '#collapse-nav2'}" onclick="javascript:logoutC();">
                        <span class="am-icon-power-off"></span>&nbsp;&nbsp;注销登录</a>
                </li>
            </ul>
        </div>
    </div>
    <!-- sidebar end -->

    <!--</div>
</div>
</div>-->
    <!-- ========== Left Sidebar end ========== -->


    <!--	<div class="am-g">-->
    <!-- ============================================================== -->
    <!-- Start right Content here -->
    <div class="content-page">
        <!-- Start content -->
        <div class="content1" style="font-size: 25px;">
            <div class="am-g">
                <!-- Row start -->
                <div class="am-u-sm-12">
                    <div class="card-box">
                        <form action="" class="am-form" data-am-validator>
                            <fieldset>
                                <legend style="font-size: 25px;">修改信息</legend>
                                <p style="font-size:25px;margin-left: 12px;">
                                    <font style="font-weight: bold;">姓&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;名：&nbsp;&nbsp;</font>
                                    <input type="text" id="subUserName" name="UserName" placeholder="请输入真实姓名"
                                           style="margin-top: 0;height: auto;display: inline-block;width: 82%;font-size: 25px;"
                                           th:value="${session.user.getUserName()}"/>
                                </p>
                                <p style="font-size:25px;margin-left: 12px;">
                                    <font style="font-weight: bold;">昵&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;称：&nbsp;&nbsp;</font>
                                    <input type="text" id="subNickName" name="NickName" placeholder="请输入昵称"
                                           style="margin-top: 0;height: auto;display: inline-block;width: 82%;font-size: 25px;"
                                           th:value="${session.user.getNickName()}"/>
                                </p>
                                <ul class="sex_radio clearfix" style="margin-bottom: 0;">
                                    <li style="font-weight: bold;font-size: 25px;border: none;">
                                        性&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;别：
                                    </li>
                                    <li id="nanli">
                                        男
                                        <input id="nan" type="radio" value="男" name="Sex"/>
                                    </li>
                                    <li id="nvli">
                                        女
                                        <input id="nv" type="radio" value="女" name="Sex"/>
                                    </li>
                                </ul>
                                <p style="font-size:25px;margin-left: 12px;">
                                    <font style="font-weight: bold;">生&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;日：&nbsp;&nbsp;</font>
                                    <input type="date" id="subBirth" name="Birth" placeholder="请选择出生年月日"
                                           style="margin-top: 0;height: auto;display: inline-block;width: 82%;font-size: 25px;"
                                           th:value="${session.user.getBirth()}"/>
                                </p>
                                <p style="font-size:25px;margin-left: 12px;">
                                    <font style="font-weight: bold;">绑定电话：&nbsp;&nbsp;</font>
                                    <input type="text" id="subUserPhone" name="UserPhone" placeholder="请输入绑定电话"
                                           style="margin-top: 0;height: auto;display: inline-block;width: 82%;font-size: 25px;"
                                           th:value="${session.user.getUserPhone()}"/>
                                </p>
                                <p style="font-size:25px;margin-left: 12px;">
                                    <font style="font-weight: bold;">绑定邮箱：&nbsp;&nbsp;</font>
                                    <input type="text" id="subUserEmail" name="UserEmail" placeholder="请输入绑定邮箱"
                                           style="margin-top: 0;height: auto;display: inline-block;width: 82%;font-size: 25px;"
                                           th:value="${session.user.getUserEmail()}"/>
                                </p>
                                <a class="am-btn am-btn-secondary" onclick="location.reload()"
                                   style="font-size:25px;">重&nbsp;&nbsp;置</a>
                                <a id="subSubmit" class="am-btn am-btn-secondary" style="float: right;font-size: 25px;"
                                        onclick="javascript:return formCheck()">提&nbsp;&nbsp;交</a>
                            </fieldset>
                        </form>


                    </div>
                </div>
                <!-- Row end -->
            </div>
        </div>
    </div>
    <!-- end right Content here -->
    <!--</div>-->
</div>
</div>

<!-- navbar -->
<a href="admin-offcanvas" class="am-icon-btn am-icon-th-list am-show-sm-only admin-menu"
   data-am-offcanvas="{target: '#admin-offcanvas'}"><!--<i class="fa fa-bars" aria-hidden="true"></i>--></a>

<script type="text/javascript" src="../assets/js/jquery-2.1.0.js"></script>
<script type="text/javascript" src="../assets/js/amazeui.min.js"></script>
<script type="text/javascript" src="../assets/js/app.js"></script>
<script type="text/javascript" src="../assets/js/blockUI.js"></script>
<script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js" type="text/javascript"></script>
<link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/sweetalert/1.1.2/sweetalert.min.css">
<script type="text/javascript" src="https://cdn.bootcss.com/sweetalert/1.1.2/sweetalert.min.js"></script>
<script>
    $(document).ready(function (e) {
        $('.sex_radio li input').click(function (e) {
            $(this).parent('li').addClass('current').append('<em></em>').siblings().removeClass('current').find('em').remove();
        });
        url = "getSex";
        $.post(url,function (sex) {
            console.log(sex);
            if(sex != null && sex !== ""){
                if(sex === "男"){
                    $("#nan").parent('li').addClass('current').append('<em></em>').siblings().removeClass('current').find('em').remove();
                    $("#nan").attr("checked","checked");
                }
                else{
                    $("#nv").parent('li').addClass('current').append('<em></em>').siblings().removeClass('current').find('em').remove();
                    $("#nv").attr("checked","checked");
                }
            }
        })
    });

    $("#subBirth").change(function(){
        $("#subBirth").attr("value",$(this).val());
    });

    function keyLogin(){
        if (event.keyCode === 13){
            document.getElementById("subSubmit").click();
        }
    };

    function formCheck() {
        var UserName = document.getElementById('subUserName').value;
        var Sex = document.getElementsByName('Sex');
        var NickName = document.getElementById('subNickName').value;
        var Birth = document.getElementById('subBirth').value;
        var UserPhone = document.getElementById('subUserPhone').value;
        var UserEmail = document.getElementById('subUserEmail').value;
        if (UserName === ""){
            swal({
                title: "姓名不能为空",
                text: "请输入用户真实姓名",
                type: "error",
                confirmButtonColor: "#011d56"
            });
            return false;
        }
        if (UserName.indexOf(" ") !== -1){
            swal({
                title: "姓名不能含空格",
                text: "请输入正确的用户姓名",
                type: "error",
                confirmButtonColor: "#011d56"
            });
            return false;
        }
        var flag = false;
        for (var i = 0; i < Sex.length; i++) {
            if (Sex[i].checked) {
                flag = true;
            }
        }
        if(flag === false){
            swal({
                title: "未选择性别",
                text: "请选择用户性别：男/女",
                type: "error",
                confirmButtonColor: "#011d56"
            });
            return false;
        }
        if (NickName === ""){
            swal({
                title: "昵称不能为空",
                text: "请输入用户昵称",
                type: "error",
                confirmButtonColor: "#011d56"
            });
            return false;
        }
        if (NickName.indexOf(" ") !== -1){
            swal({
                title: "昵称不能含空格",
                text: "请输入正确的用户昵称",
                type: "error",
                confirmButtonColor: "#011d56"
            });
            return false;
        }
        if (Birth === ""){
            swal({
                title: "出生日期不能为空",
                text: "请选择用户出生年月日",
                type: "error",
                confirmButtonColor: "#011d56"
            });
            return false;
        }
        if (UserPhone === ""){
            swal({
                title: "联系电话不能为空",
                text: "请输入联系电话",
                type: "error",
                confirmButtonColor: "#011d56"
            });
            return false;
        }
        if (UserPhone.search(/^1[3456789]\d{9}$/) === -1){
            swal({
                title: "联系电话格式错误",
                text: "联系电话必须是以1开头，第二位为3~9的11位数字串",
                type: "error",
                confirmButtonColor: "#011d56"
            });
            return false;
        }
        if (UserEmail === ""){
            swal({
                title: "邮箱不能为空",
                text: "请输入邮箱",
                type: "error",
                confirmButtonColor: "#011d56"
            });
            return false;
        }
        if (UserEmail.search(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+$/) === -1){
            swal({
                title: "邮箱格式错误",
                text: "请输入有效的邮箱地址，如：youxiang@163.com",
                type: "error",
                confirmButtonColor: "#011d56"
            });
            return false;
        }
        return true;
    }
    $("#subSubmit").click(function () {
        if(formCheck() === true){
            var UserName = $("#subUserName").val();
            var Sex = $('input[name="Sex"]:checked').val();
            var NickName = $("#subNickName").val();
            var Birth = $("#subBirth").val();
            var UserPhone = $("#subUserPhone").val();
            var UserEmail = $("#subUserEmail").val();
            var url = "updateUser";
            var data = {
                UserName: UserName,
                Sex: Sex,
                NickName: NickName,
                Birth: Birth,
                UserPhone: UserPhone,
                UserEmail: UserEmail
            }
            $.post(url, data, function (result) {
                if(result != null && result.code === 200){
                    window.location.href="myInfo";
                }
                else if(result != null && result.code === 0){
                    swal({
                        title: "该邮箱已被使用",
                        text: "该邮箱已被使用，请使用其他邮箱",
                        type: "error",
                        confirmButtonColor: "#011d56"
                    });
                }
                else {
                    swal({
                        title: "更新失败",
                        text: "请确认输入内容并重试",
                        type: "error",
                        confirmButtonColor: "#011d56"
                    });
                }
            })
        }
    })

    function logoutC() {
        swal({
                title: "确定注销吗？",
                text: "您将退出登录！",
                type: "warning",
                showCancelButton: true,
                confirmButtonColor: "#011d56",
                confirmButtonText: "确定",
                cancelButtonText: "取消",
                closeOnConfirm: false,
            },
            function(isConfirm){
                if (isConfirm) {
                    window.location.href="logout";
                }
            });
    }
</script>
</body>

</html>
