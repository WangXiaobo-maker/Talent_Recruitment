<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <link rel="alternate" media="handheld"  />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>无限创想人才招聘平台</title>
    <meta property="qc:admins" content="23635710066417756375" />
    <meta name="baidu-site-verification" content="QIQ6KC1oZ6" />
    <script type="text/javascript">
        var ctx = "h";
        console.log(1);
    </script>
    <link rel="Shortcut Icon" href="h/images/favicon.ico">
    <link rel="stylesheet" type="text/css" th:href="@{static/css/style.css}"/>
    <link rel="stylesheet" type="text/css" th:href="@{static/css/index.css}"/>
    <script src="../static/js/jquery.1.10.1.min.js" th:src="@{static/js/jquery.1.10.1.min.js}" type="text/javascript"></script>
    <script type="text/javascript" src="../static/js/jquery.lib.min.js" th:src="@{static/js/jquery.lib.min.js}"></script>
    <script type="text/javascript" th:src="@{static/js/core.min.js}"></script>
    <link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/sweetalert/1.1.2/sweetalert.min.css">
    <script type="text/javascript" src="https://cdn.bootcss.com/sweetalert/1.1.2/sweetalert.min.js"></script>
    <script type="text/javascript">
        var youdao_conv_id = 271546;
    </script>
    <script type="text/javascript" th:src="@{static/js/conv.js}"></script>
</head>

<body onkeydown="keyLogin()">
<main>
    <div class="login_box_btm"></div>
    <div id="overlay"></div>
    <ul id="scene">
        <li class="layer" data-depth="0.1">
            <div class="layer1"></div>
        </li>
        <li class="layer" data-depth="0.2">
            <div class="layer2"></div>
        </li>
    </ul>
    <div class="login_wrapper">
        <div class="login_header">
            <a href="home"><img th:src="@{static/img/logo_white.png}" width="285" height="62" alt="无限创想" /></a>
            <div id="cloud_s"><img th:src="@{static/img/cloud_s.png}" width="81" height="52" alt="cloud" /></div>
            <div id="cloud_m"><img th:src="@{static/img/cloud_m.png}" width="136" height="95"  alt="cloud" /></div>
        </div>

        <input type="hidden" id="resubmitToken" value="" />
        <div class="login_box">
            <form id="loginForm">
                <ul class="register_radio clearfix">
                    <li>
                        企&nbsp;&nbsp;业
                        <input type="radio" value="0" name="type" />
                    </li>
                    <li>
                        个&nbsp;&nbsp;人
                        <input type="radio" value="1" name="type" />
                    </li>
                </ul>
                <input type="text" id="email" name="email" tabindex="1" placeholder="请输入绑定的邮箱" />
                <input type="text" id="phone" name="phone" tabindex="1" placeholder="请输入绑定的电话" />
                <input type="text" id="name" name="name" tabindex="1" placeholder="请输入用户姓名/公司名称" />
                <input type="password" id="password" name="password" tabindex="2" placeholder="请输入新密码" />
                <input type="password" id="confirmpassword" name="confirmpassword" tabindex="2" placeholder="请输入确认密码" />

                <a id="submit" style="color:#fff;margin-left:80px;" class="submitLogin" title="确 &nbsp; &nbsp; 认"
                   onclick="javascript:return formCheck()">确 &nbsp; &nbsp; 认</a>
            </form>
            <div class="login_right"><br><br><br>
                <img th:src="@{static/img/login_ico.png}" width="130" height="120" /><br>
                <div>已想起密码？</div>
                <a  th:href="@{'redirLogin'}" class="registor_now">立即登录</a>
            </div>
        </div>
    </div>
</main>

<script th:src="@{static/js/mouse-click.js}"></script>
<canvas width="100%" height="100%"
        style="position: fixed; left: 0px; top: 0px; z-index: 2147483647; pointer-events: none;"></canvas>

<script src="http://apps.bdimg.com/libs/jquery/2.1.1/jquery.min.js" type="text/javascript"></script>
<script th:src="@{static/js/jquery.parallax.min.js}"></script>
<script>
    $(document).ready(function () {
        $('#scene').parallax();
    });

    $(document).ready(function(e) {
        $('.register_radio li input').click(function (e) {
            $(this).parent('li').addClass('current').append('<em></em>').siblings().removeClass('current').find('em').remove();
        });
    });

    function keyLogin(){
        if (event.keyCode === 13){
            document.getElementById("submit").click();
        }
    };

    function formCheck() {
        var email = document.getElementById('email').value;
        var phone = document.getElementById('phone').value;
        var name = document.getElementById('name').value;
        var password = document.getElementById('password').value;
        var confirmpassword = document.getElementById('confirmpassword').value;
        var type = document.getElementsByName('type');
        if (email === ""){
            swal({
                title: "绑定邮箱不能为空",
                text: "请输入绑定的邮箱",
                type: "error",
                confirmButtonColor: "#011d56"
            });
            return false;
        }
        if (phone === ""){
            swal({
                title: "绑定电话不能为空",
                text: "请输入绑定的电话",
                type: "error",
                confirmButtonColor: "#011d56"
            });
            return false;
        }
        if (name === ""){
            swal({
                title: "用户姓名/公司名称不能为空",
                text: "请输入用户姓名/公司名称",
                type: "error",
                confirmButtonColor: "#011d56"
            });
            return false;
        }
        if (password === ""){
            swal({
                title: "新密码不能为空",
                text: "请输入新密码",
                type: "error",
                confirmButtonColor: "#011d56"
            });
            return false;
        }
        if (password.search(/^.*(?=.{6,})(?=.*\d)(?=.*[a-zA-Z]).*$/) === -1){
            swal({
                title: "密码格式错误",
                text: "密码必须为6位以上字母/数字/符号组合，至少包含一个字母和数字",
                type: "error",
                confirmButtonColor: "#011d56"
            });
            return false;
        }
        if (password !== confirmpassword){
            swal({
                title: "两次输入的密码不一致",
                text: "请重新输入",
                type: "error",
                confirmButtonColor: "#011d56"
            });
            return false;
        }
        var flag = false;
        for (var i = 0; i < type.length; i++) {
            if (type[i].checked) {
                flag = true;
            }
        }
        if(flag === false){
            swal({
                title: "未选择用户身份",
                text: "请选择找回密码的用户身份：企业/个人",
                type: "error",
                confirmButtonColor: "#011d56"
            });
            return false;
        }
        return true;
    }

    $("#submit").click(function () {
        if(formCheck() === true){
            var email = $("#email").val();
            var phone = $("#phone").val();
            var name = $("#name").val();
            var password = $("#password").val();
            var type = $('input[name="type"]:checked').val();
            var url = "toForgotPwd";
            var data = {
                email: email,
                phone: phone,
                name: name,
                password: password,
                type: type
            }
            $.post(url, data, function (result) {
                if(result != null && result.code === 200){
                    swal({
                            title: "密码重置成功，请登录",
                            type: "success",
                            confirmButtonColor: "#011d56",
                        },
                        function(isConfirm){
                            if (isConfirm) {
                                window.location.href="redirLogin";
                            }
                        });
                }
                else if(result != null && result.code === 0){
                    if(result.message === "用户邮箱/电话/姓名错误"){
                        swal({
                            title: "用户邮箱/电话/姓名错误",
                            text: "请确认用户邮箱、电话、姓名后重试",
                            type: "error",
                            confirmButtonColor: "#011d56"
                        });
                    }
                    else{
                        swal({
                            title: "公司邮箱/电话/名称错误",
                            text: "请确认公司邮箱、电话、名称后重试",
                            type: "error",
                            confirmButtonColor: "#011d56"
                        });
                    }
                }
                else {
                    swal({
                        title: "密码重置失败",
                        text: "请确认输入内容并重试",
                        type: "error",
                        confirmButtonColor: "#011d56"
                    });
                }
            })
        }
    })
</script>

</body>
</html>